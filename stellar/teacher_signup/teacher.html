<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teacher Verification - Stellar Mind</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    :root {
      --primary-bg: #f0f4f8;
      --secondary-bg: #ffffff;
      --text-color: #1c2b3a;
      --subtle-text: #6b7a8c;
      --accent-start: #4299e1;
      --accent-end: #0087c5;
      --error-color: #e53e3e;
      --success-color: #38a169;
      --transition-speed: 0.5s;
    }

    /* ... Other CSS styles remain the same ... */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: var(--primary-bg);
      color: var(--text-color);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      position: relative;
    }

    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 10% 10%, rgba(66, 153, 225, 0.1) 0%, transparent 50%), radial-gradient(circle at 90% 90%, rgba(0, 135, 197, 0.1) 0%, transparent 50%);
      animation: pulseBackground 10s infinite alternate;
      z-index: -1;
    }

    @keyframes pulseBackground {
      from {
        transform: scale(1);
      }

      to {
        transform: scale(1.1);
      }
    }

    .signup-container {
      background: var(--secondary-bg);
      padding: 2.5rem 3rem;
      border-radius: 1.5rem;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
      width: 100%;
      max-width: 30rem;
      text-align: center;
      border: 1px solid rgba(0, 0, 0, 0.05);
      animation: fadeInUp 0.8s forwards;
      opacity: 0;
      transform: translateY(-1rem);
    }

    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .signup-header {
      margin-bottom: 2rem;
    }

    .signup-header h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: var(--text-color);
    }

    .signup-header h1 span {
      background: linear-gradient(90deg, var(--accent-start), var(--accent-end));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .signup-header p {
      color: var(--subtle-text);
      font-size: 1rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
      text-align: left;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--subtle-text);
    }

    .input-wrapper {
      position: relative;
    }

    .input-wrapper .icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--subtle-text);
    }

    .form-group input {
      width: 100%;
      padding: 0.75rem 1rem 0.75rem 2.75rem;
      border-radius: 0.5rem;
      border: 1px solid #ccc;
      font-size: 1rem;
      transition: all var(--transition-speed);
    }

    .form-group input:focus {
      outline: none;
      border-color: var(--accent-start);
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.2);
    }

    .btn {
      background: linear-gradient(90deg, var(--accent-start), var(--accent-end));
      color: #fff;
      padding: 0.75rem 1.5rem;
      border-radius: 2rem;
      text-decoration: none;
      font-weight: bold;
      transition: all var(--transition-speed) ease;
      box-shadow: 0 4px 15px rgba(66, 153, 225, 0.3);
      border: none;
      cursor: pointer;
      width: 100%;
      font-size: 1rem;
      display: block;
    }

    .btn:hover {
      transform: translateY(-0.25rem) scale(1.02);
      box-shadow: 0 6px 20px rgba(0, 135, 197, 0.4);
    }

    .btn:disabled {
      background: var(--subtle-text);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .message {
      padding: 0.75rem;
      margin-top: 1.5rem;
      border-radius: 0.5rem;
      font-weight: 500;
      display: none;
    }

    .message.error {
      background-color: var(--error-color);
      color: white;
      display: block;
    }

    .message.success {
      background-color: var(--success-color);
      color: white;
      display: block;
    }

    .home-link {
      margin-top: 1.5rem;
    }

    .home-link a {
      color: var(--subtle-text);
      text-decoration: none;
      transition: color var(--transition-speed);
    }

    .home-link a:hover {
      color: var(--accent-end);
    }
  </style>
</head>

<body>
  <div class="signup-container">
    <div class="signup-header">
      <h1>Teacher <span>Verification</span></h1>
      <p>Please enter your registered institute email to continue.</p>
    </div>
    <form id="email-verification-form">
      <div class="form-group">
        <label for="email">Institute Email Address</label>
        <div class="input-wrapper">
          <i class="fas fa-envelope icon"></i>
          <input type="email" id="email" name="email" placeholder="e.g., yourname@nitsikkim.ac.in" required>
        </div>
      </div>
      <button type="submit" class="btn" id="submit-btn">
        <span class="btn-text">Send Verification Code</span>
      </button>
    </form>
    <div id="message-container"></div>
    <div class="home-link">
      <a href="../index.html"><i class="fas fa-arrow-left"></i> Back to Home</a>
    </div>
  </div>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
    const SUPABASE_URL = "https://yrzpuxhvktpcwksmlnwl.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlyenB1eGh2a3RwY3drc21sbndsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyOTY1NzksImV4cCI6MjA3MTg3MjU3OX0.rjUVbGsQvPsLaua936DqA9fB5CVq8puRTq6DgJ1L_bs";
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // =============================
        // Attempt to Disable Developer Tools
        // NOTE: This is not a secure or foolproof method.
        // Determined users can always bypass these measures.
        // =============================
        document.addEventListener('contextmenu', event => event.preventDefault());
        document.addEventListener('keydown', event => {
            // Prevent F12
            if (event.key === 'F12' || (event.keyCode && event.keyCode === 123)) {
                event.preventDefault();
            }
            // Prevent Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
            if (event.ctrlKey && event.shiftKey && ['I', 'J'].includes(event.key.toUpperCase())) {
                event.preventDefault();
            }
            if (event.ctrlKey && event.key.toUpperCase() === 'U') {
                event.preventDefault();
            }
        });

    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("email-verification-form");
      const emailInput = document.getElementById("email");
      const messageContainer = document.getElementById("message-container");
      const submitBtn = document.getElementById("submit-btn");
      const btnText = document.querySelector(".btn-text");

      const showMessage = (text, type) => {
        messageContainer.innerHTML = `<div class="message ${type}">${text}</div>`;
      };

      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        messageContainer.innerHTML = "";
        submitBtn.disabled = true;
        btnText.textContent = "Verifying...";
        const email = emailInput.value.trim();

        try {
          const { data: teacher, error: checkError } = await supabase
            .from('teacherportal')
            .select('*')
            .eq('email', email)
            .single();

          if (checkError) {
            throw new Error('This email is not registered. Please contact the administrator.');
          }

          if (teacher) {
            const teacherName = teacher.teacher_name || 'Teacher';
            const { data, error: invokeError } = await supabase.functions.invoke('send-verification-email', {
              body: { email: email, name: teacherName },
            });

            if (invokeError) throw invokeError;
            if (data.error) throw new Error(data.error);

            showMessage('âœ… A verification code has been sent.', 'success');
            sessionStorage.setItem('verificationEmail', email);

            setTimeout(() => {
              // This correctly redirects to 'verify.html' in the same folder
              window.location.href = 'verify.html';
            }, 2000);
          }
        } catch (error) {
          console.error('Verification Error:', error);
          showMessage(`ðŸ”¥ ${error.message}`, 'error');
          submitBtn.disabled = false;
          btnText.textContent = "Send Verification Code";
        }
      });
    });
  </script>
</body>

</html>